# ä½ä»£ç å¯è§†åŒ–ç¼–è¾‘å™¨ - æŠ€æœ¯å®ç°æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
- [ç»„ä»¶ç³»ç»Ÿè®¾è®¡](#ç»„ä»¶ç³»ç»Ÿè®¾è®¡)
- [æ‹–æ‹½ç³»ç»Ÿå®ç°](#æ‹–æ‹½ç³»ç»Ÿå®ç°)
- [ä»£ç å¯¼å‡ºæœºåˆ¶](#ä»£ç å¯¼å‡ºæœºåˆ¶)
- [å¾®å‰ç«¯é›†æˆ](#å¾®å‰ç«¯é›†æˆ)

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

ä½ä»£ç å¯è§†åŒ–ç¼–è¾‘å™¨æ˜¯åŸºäº React + TypeScript æ„å»ºçš„å¯è§†åŒ–é¡µé¢æ„å»ºå·¥å…·ï¼Œæ”¯æŒæ‹–æ‹½å¼ç»„ä»¶ç¼–è¾‘ã€å®æ—¶é¢„è§ˆå’Œå¤šæ ¼å¼ä»£ç å¯¼å‡ºã€‚é‡‡ç”¨å¾®å‰ç«¯æ¶æ„è®¾è®¡ï¼Œå¯ç‹¬ç«‹è¿è¡Œæˆ–é›†æˆåˆ°å…¶ä»–å¹³å°ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- **å¯è§†åŒ–ç¼–è¾‘**: æ‹–æ‹½ç»„ä»¶åˆ°ç”»å¸ƒï¼Œå®æ—¶é¢„è§ˆæ•ˆæœ
- **å±æ€§é…ç½®**: åŠ¨æ€ç¼–è¾‘ç»„ä»¶å±æ€§ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹
- **ä»£ç å¯¼å‡º**: ç”Ÿæˆ React JSXã€HTMLã€JSON ä¸‰ç§æ ¼å¼ä»£ç 
- **å¾®å‰ç«¯æ”¯æŒ**: åŸºäº qiankun æ¡†æ¶çš„å¾®å‰ç«¯æ¶æ„
- **ç»„ä»¶æ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶å’Œç¬¬ä¸‰æ–¹ç»„ä»¶åº“é›†æˆ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä½ä»£ç ç¼–è¾‘å™¨æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI å±‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Toolbar    â”‚MaterialPanelâ”‚   Canvas    â”‚PropertyPanelâ”‚  â”‚
â”‚  â”‚  å·¥å…·æ       â”‚   ç‰©æ–™é¢æ¿    â”‚    ç”»å¸ƒ      â”‚   å±æ€§é¢æ¿   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡é€»è¾‘å±‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ DnD System  â”‚ Component   â”‚ Renderer    â”‚ Exporter    â”‚  â”‚
â”‚  â”‚ æ‹–æ‹½ç³»ç»Ÿ     â”‚ ç»„ä»¶ç³»ç»Ÿ     â”‚ æ¸²æŸ“å¼•æ“     â”‚ å¯¼å‡ºç³»ç»Ÿ     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çŠ¶æ€ç®¡ç†å±‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Zustand Store                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Canvas Stateâ”‚ Component   â”‚ Selection & UI State    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ç”»å¸ƒçŠ¶æ€     â”‚ ç»„ä»¶æ ‘çŠ¶æ€   â”‚ é€‰ä¸­çŠ¶æ€å’ŒUIçŠ¶æ€         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

| æŠ€æœ¯åˆ†ç±»     | æŠ€æœ¯é€‰å‹              | å®ç°åŠŸèƒ½             |
| ------------ | --------------------- | -------------------- |
| **å‰ç«¯æ¡†æ¶** | React 19 + TypeScript | ç»„ä»¶åŒ–å¼€å‘ï¼Œç±»å‹å®‰å…¨ |
| **çŠ¶æ€ç®¡ç†** | Zustand               | è½»é‡çº§çŠ¶æ€ç®¡ç†       |
| **æ‹–æ‹½åŠŸèƒ½** | React DnD             | ç»„ä»¶æ‹–æ‹½å’Œå®šä½       |
| **UI ç»„ä»¶**  | Ant Design            | åŸºç¡€ UI ç»„ä»¶         |
| **æ„å»ºå·¥å…·** | Vite 6                | å¼€å‘æ„å»ºå’Œçƒ­æ›´æ–°     |
| **å¾®å‰ç«¯**   | qiankun               | å¾®å‰ç«¯åº”ç”¨é›†æˆ       |

## ğŸ§© æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ç¼–è¾‘å™¨ä¸»å®¹å™¨

**å®ç°æ–‡ä»¶**: `src/components/Editor/index.tsx`

ç¼–è¾‘å™¨é‡‡ç”¨å››åŒºåŸŸå¸ƒå±€è®¾è®¡ï¼šå·¥å…·æ  + ç‰©æ–™é¢æ¿ + ç”»å¸ƒ + å±æ€§é¢æ¿ã€‚é€šè¿‡ React DnD æä¾›å…¨å±€æ‹–æ‹½ä¸Šä¸‹æ–‡ã€‚

```typescript
const Editor: React.FC = () => {
  return (
    <DndProvider backend={HTML5Backend}>
      <div className={styles.editorContainer}>
        <Toolbar />
        <div className={styles.contentContainer}>
          <MaterialPanel />
          <Canvas />
          <PropertyPanel />
        </div>
      </div>
    </DndProvider>
  );
};
```

### 2. çŠ¶æ€ç®¡ç†å®ç°

**å®ç°æ–‡ä»¶**: `src/store/editorStore.ts`

åŸºäº Zustand å®ç°è½»é‡çº§çŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒç»„ä»¶æ ‘çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼š

```typescript
interface EditorState {
  canvas: {
    components: ComponentConfig[];
    style: React.CSSProperties;
  };
  selectedId: string | null;
  canvasScale: number;

  addComponent: (component) => void;
  updateComponent: (id, updates) => void;
  removeComponent: (id) => void;
}
```

### 3. å·¥å…·æ åŠŸèƒ½

**å®ç°æ–‡ä»¶**: `src/components/Editor/Toolbar/Toolbar.tsx`

- **ç”»å¸ƒå°ºå¯¸æ§åˆ¶**: é€šè¿‡ InputNumber ç»„ä»¶åŠ¨æ€è°ƒæ•´ç”»å¸ƒå®½é«˜
- **ç¼©æ”¾åŠŸèƒ½**: æä¾› 50%-150% çš„ç¼©æ”¾é€‰é¡¹
- **ä»£ç å¯¼å‡º**: è§¦å‘å¯¼å‡ºæ¨¡æ€æ¡†
- **ç”»å¸ƒæ¸…ç©º**: ä¸€é”®æ¸…é™¤æ‰€æœ‰ç»„ä»¶

### 4. ç‰©æ–™é¢æ¿å®ç°

**å®ç°æ–‡ä»¶**: `src/components/Editor/MaterialPanel/MaterialPanel.tsx`

ç‰©æ–™é¢æ¿å±•ç¤ºå¯ç”¨ç»„ä»¶ï¼Œæ”¯æŒæ‹–æ‹½åˆ°ç”»å¸ƒã€‚ç»„ä»¶æŒ‰åˆ†ç±»ç»„ç»‡ï¼š

- **è‡ªå®šä¹‰ç»„ä»¶**: Text, Image, Div, FlexContainer, CustomButton, CustomInput, CustomTable, BarChart
- **Ant Design ç»„ä»¶**: antd.Button, antd.Input

æ¯ä¸ªç‰©æ–™é¡¹é€šè¿‡ useDrag Hook å®ç°æ‹–æ‹½åŠŸèƒ½ï¼š

```typescript
const [{ isDragging }, drag] = useDrag(() => ({
  type: 'MATERIAL',
  item: { type: material.type },
  collect: (monitor) => ({ isDragging: monitor.isDragging() }),
}));
```

### 5. ç”»å¸ƒç³»ç»Ÿå®ç°

**å®ç°æ–‡ä»¶**: `src/components/Editor/Canvas/Canvas.tsx`

ç”»å¸ƒé‡‡ç”¨åŒå±‚å¸ƒå±€ç³»ç»Ÿï¼š

- **æ ¹çº§ç»„ä»¶**: ä½¿ç”¨ç»å¯¹å®šä½ï¼Œæ”¯æŒè‡ªç”±æ‹–æ‹½
- **å­ç»„ä»¶**: ä½¿ç”¨æµå¼å¸ƒå±€ï¼Œåœ¨å®¹å™¨å†…è‡ªåŠ¨æ’åˆ—

æ‹–æ‹½æ¥æ”¶é€»è¾‘å¤„ç†åæ ‡è®¡ç®—ã€è¾¹ç•Œæ£€æŸ¥å’Œç»„ä»¶åˆ›å»ºï¼š

```typescript
const [{ isOver }, drop] = useDrop(() => ({
  accept: ['MATERIAL'],
  drop: (item, monitor) => {
    const dropPoint = monitor.getClientOffset();
    // è®¡ç®—ç›¸å¯¹ç”»å¸ƒåæ ‡ï¼Œè€ƒè™‘ç¼©æ”¾å’Œæ»šåŠ¨
    let x = (dropPoint.x - canvasRect.left + scrollLeft) / canvasScale;
    let y = (dropPoint.y - canvasRect.top + scrollTop) / canvasScale;

    addComponent({
      type: material.type,
      style: { position: 'absolute', left: `${x}px`, top: `${y}px` },
    });
  },
}));
```

### 6. å±æ€§é¢æ¿å®ç°

**å®ç°æ–‡ä»¶**: `src/components/Editor/PropertyPanel/PropertyPanel.tsx`

æ ¹æ®ç»„ä»¶ç±»å‹åŠ¨æ€æ¸²æŸ“å±æ€§ç¼–è¾‘å™¨ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼š

- **string**: Input æ–‡æœ¬è¾“å…¥
- **number**: InputNumber æ•°å­—è¾“å…¥
- **boolean**: Switch å¼€å…³
- **select**: Select ä¸‹æ‹‰é€‰æ‹©
- **color**: ColorPicker é¢œè‰²é€‰æ‹©

ç‰¹æ®Šç»„ä»¶æä¾›ä¸“é—¨çš„ç¼–è¾‘ç•Œé¢ï¼š

- **BarChart**: æ•°ç»„æ ¼å¼çš„æ•°æ®ç¼–è¾‘
- **CustomTable**: è¡¨æ ¼ç»“æ„ç¼–è¾‘

### 7. æ‹–æ‹½å®šä½ç³»ç»Ÿ

**å®ç°æ–‡ä»¶**: `src/hooks/useDragPosition.ts`

è‡ªå®šä¹‰ Hook å®ç°ç»„ä»¶åœ¨ç”»å¸ƒä¸Šçš„ç²¾ç¡®å®šä½ï¼š

```typescript
const handleMouseMove = (moveEvent: MouseEvent) => {
  const deltaX = moveEvent.clientX - startPositionRef.current.x;
  const deltaY = moveEvent.clientY - startPositionRef.current.y;

  // è€ƒè™‘ç”»å¸ƒç¼©æ”¾æ¯”ä¾‹
  const newLeft = initialStyleRef.current.left + deltaX / canvasScale;
  const newTop = initialStyleRef.current.top + deltaY / canvasScale;

  // è¾¹ç•Œæ£€æŸ¥å¹¶æ›´æ–°ä½ç½®
  updateComponent(componentId, {
    style: { left: `${boundedLeft}px`, top: `${boundedTop}px` },
  });
};
```

## ğŸ¨ ç»„ä»¶ç³»ç»Ÿè®¾è®¡

### ç»„ä»¶æ•°æ®ç»“æ„

```typescript
interface ComponentConfig {
  id: string; // å”¯ä¸€æ ‡è¯†
  type: string; // ç»„ä»¶ç±»å‹
  name: string; // æ˜¾ç¤ºåç§°
  props: ComponentProps; // ç»„ä»¶å±æ€§
  children?: ComponentConfig[]; // å­ç»„ä»¶ï¼ˆæ”¯æŒåµŒå¥—ï¼‰
  style?: React.CSSProperties; // æ ·å¼é…ç½®
}

interface ComponentDefinition {
  type: string; // ç»„ä»¶ç±»å‹æ ‡è¯†
  name: string; // æ˜¾ç¤ºåç§°
  category: ComponentType; // åˆ†ç±»
  defaultProps: ComponentProps; // é»˜è®¤å±æ€§
  propConfig: PropConfig[]; // å±æ€§é…ç½®
}
```

### ç»„ä»¶åˆ†ç±»ä½“ç³»

```
ç»„ä»¶ç³»ç»Ÿ
â”œâ”€â”€ åŸºç¡€ç»„ä»¶ (basic)
â”‚   â”œâ”€â”€ Text - æ–‡æœ¬ç»„ä»¶
â”‚   â”œâ”€â”€ Image - å›¾ç‰‡ç»„ä»¶
â”‚   â””â”€â”€ Div - å®¹å™¨ç»„ä»¶
â”œâ”€â”€ å¸ƒå±€ç»„ä»¶ (container)
â”‚   â””â”€â”€ FlexContainer - Flexå¸ƒå±€å®¹å™¨
â”œâ”€â”€ äº¤äº’ç»„ä»¶ (basic)
â”‚   â”œâ”€â”€ CustomButton - è‡ªå®šä¹‰æŒ‰é’®
â”‚   â””â”€â”€ CustomInput - è‡ªå®šä¹‰è¾“å…¥æ¡†
â”œâ”€â”€ é«˜çº§ç»„ä»¶ (advanced)
â”‚   â”œâ”€â”€ CustomTable - æ•°æ®è¡¨æ ¼
â”‚   â””â”€â”€ BarChart - æŸ±çŠ¶å›¾
â””â”€â”€ ç¬¬ä¸‰æ–¹ç»„ä»¶ (antd)
    â”œâ”€â”€ antd.Button - Ant DesignæŒ‰é’®
    â””â”€â”€ antd.Input - Ant Designè¾“å…¥æ¡†
```

### æ¸²æŸ“å™¨ç³»ç»Ÿ

**å®ç°æ–‡ä»¶**: `src/components/renderer/index.tsx`

ç»Ÿä¸€çš„ç»„ä»¶æ¸²æŸ“å…¥å£ï¼Œæ”¯æŒè‡ªå®šä¹‰ç»„ä»¶å’Œç¬¬ä¸‰æ–¹ç»„ä»¶ï¼š

```typescript
const componentMap = {
  Text: TextRenderer,
  Image: ImageRenderer,
  CustomButton: CustomButtonRenderer,
  // ...
};

export const renderComponent = (config: ComponentConfig) => {
  const { type, props } = config;

  // æ¸²æŸ“è‡ªå®šä¹‰ç»„ä»¶
  if (componentMap[type]) {
    const Component = componentMap[type];
    return <Component props={props} />;
  }

  // æ¸²æŸ“ Ant Design ç»„ä»¶
  if (type.startsWith('antd.')) {
    const componentName = type.split('.')[1];
    switch (componentName) {
      case 'Button':
        return <Button {...props} />;
      case 'Input':
        return <Input {...props} />;
    }
  }

  return <div>æœªçŸ¥ç»„ä»¶: {type}</div>;
};
```

## ğŸ¯ æ‹–æ‹½ç³»ç»Ÿå®ç°

### React DnD æ¶æ„

```
æ‹–æ‹½ç³»ç»Ÿæ¶æ„
â”œâ”€â”€ DndProvider (HTML5Backend)
â”‚   â”œâ”€â”€ ç‰©æ–™é¢æ¿ (Drag Source)
â”‚   â”‚   â””â”€â”€ MaterialItem (useDrag)
â”‚   â”œâ”€â”€ ç”»å¸ƒ (Drop Target)
â”‚   â”‚   â”œâ”€â”€ Canvas (useDrop) - æ ¹çº§æ‹–æ”¾
â”‚   â”‚   â””â”€â”€ CanvasItem (useDrop) - åµŒå¥—æ‹–æ”¾
â”‚   â””â”€â”€ ç»„ä»¶å®šä½ (Drag Source)
â”‚       â””â”€â”€ CanvasItem (useDragPosition)
```

### æ‹–æ‹½ç±»å‹å®šä¹‰

```typescript
// æ‹–æ‹½ç±»å‹
type DragType = 'MATERIAL';

// æ‹–æ‹½æ•°æ®
interface DragItem {
  type: string; // ç»„ä»¶ç±»å‹
}

// æ‹–æ‹½çŠ¶æ€
interface DragCollectedProps {
  isDragging: boolean;
  isOver: boolean;
}
```

### åæ ‡è®¡ç®—é€»è¾‘

è€ƒè™‘ç”»å¸ƒç¼©æ”¾ã€æ»šåŠ¨å’Œè¾¹ç•Œæ£€æŸ¥çš„ç²¾ç¡®åæ ‡è®¡ç®—ï¼š

```typescript
const calculatePosition = (dropPoint, canvasElement, canvasScale) => {
  const canvasRect = canvasElement.getBoundingClientRect();
  const scrollLeft = canvasElement.scrollLeft;
  const scrollTop = canvasElement.scrollTop;

  let x = (dropPoint.x - canvasRect.left + scrollLeft) / canvasScale;
  let y = (dropPoint.y - canvasRect.top + scrollTop) / canvasScale;

  // è¾¹ç•Œæ£€æŸ¥
  x = Math.max(0, Math.min(x, canvasWidth - componentWidth));
  y = Math.max(0, Math.min(y, canvasHeight - componentHeight));

  return { x, y };
};
```

## ğŸ“¤ ä»£ç å¯¼å‡ºæœºåˆ¶

### å¯¼å‡ºæ ¼å¼æ”¯æŒ

| æ ¼å¼          | ç”¨é€”              | ç‰¹ç‚¹                       |
| ------------- | ----------------- | -------------------------- |
| **React JSX** | é›†æˆåˆ° React é¡¹ç›® | å®Œæ•´çš„ç»„ä»¶ä»£ç ï¼Œæ”¯æŒäº¤äº’   |
| **HTML**      | é™æ€é¡µé¢éƒ¨ç½²      | åŒ…å«å†…è”æ ·å¼ï¼Œå¯ç›´æ¥è¿è¡Œ   |
| **JSON**      | æ•°æ®äº¤æ¢          | çº¯æ•°æ®æ ¼å¼ï¼Œä¾¿äºå­˜å‚¨å’Œä¼ è¾“ |

### å¯¼å‡ºå®ç°

**å®ç°æ–‡ä»¶**: `src/utils/exporters/`

JSX å¯¼å‡ºæ ¸å¿ƒé€»è¾‘ï¼š

```typescript
export const exportToReactCode = () => {
  const { canvas } = useEditorStore.getState();

  // ç”Ÿæˆç»„ä»¶ä»£ç 
  const componentCode = canvas.components
    .map((component) => generateComponentJSX(component))
    .join('\n');

  // ç”Ÿæˆå®Œæ•´çš„ React ç»„ä»¶
  return `
import React from 'react';

const GeneratedPage = () => {
  return (
    <div style={${serializeStyleForJsx(canvas.style)}}>
      ${componentCode}
    </div>
  );
};

export default GeneratedPage;
  `;
};
```

### æ ·å¼åºåˆ—åŒ–

**å®ç°æ–‡ä»¶**: `src/utils/styleSerialize.ts`

æ”¯æŒ JSX å’Œ HTML ä¸¤ç§æ ·å¼æ ¼å¼ï¼š

```typescript
// JSX æ ·å¼åºåˆ—åŒ–
export const serializeStyleForJsx = (style?: StyleLike): string => {
  return Object.entries(style || {})
    .filter(([, v]) => v !== undefined && v !== null)
    .map(([k, v]) => {
      if (typeof v === 'number') return `${k}: ${v}`;
      return `${k}: '${String(v).replace(/'/g, "\\'")}'`;
    })
    .join(', ');
};

// HTML æ ·å¼åºåˆ—åŒ–
export const serializeStyleForHtml = (style?: StyleLike): string => {
  return Object.entries(style || {})
    .map(([k, v]) => {
      const property = camelToKebab(k);
      const value = typeof v === 'number' ? `${v}px` : String(v);
      return `${property}: ${value}`;
    })
    .join('; ');
};
```

## ğŸ”§ å¾®å‰ç«¯é›†æˆ

### qiankun ç”Ÿå‘½å‘¨æœŸ

**å®ç°æ–‡ä»¶**: `src/main.tsx`

å¾®å‰ç«¯ç”Ÿå‘½å‘¨æœŸé…ç½®ï¼Œæ”¯æŒç‹¬ç«‹è¿è¡Œå’Œé›†æˆè¿è¡Œï¼š

```typescript
renderWithQiankun({
  bootstrap() {
    console.log('ä½ä»£ç åº”ç”¨å¯åŠ¨');
  },

  mount(props: QiankunProps) {
    console.log('ä½ä»£ç åº”ç”¨æŒ‚è½½', props);
    render(props);
  },

  unmount(props: QiankunProps) {
    console.log('ä½ä»£ç åº”ç”¨å¸è½½', props);
    unmount();
  },

  update(props: QiankunProps) {
    console.log('ä½ä»£ç åº”ç”¨æ›´æ–°', props);
  },
});

// ç‹¬ç«‹è¿è¡Œæ¨¡å¼
if (!qiankunWindow.__POWERED_BY_QIANKUN__) {
  render();
}
```

### æ„å»ºé…ç½®

**å®ç°æ–‡ä»¶**: `vite.config.ts`

```typescript
export default defineConfig({
  plugins: [
    react(),
    qiankun('low-code-app', {
      useDevMode: true,
    }),
  ],
  server: {
    port: 3001,
    cors: true,
    origin: 'http://localhost:3001',
  },
});
```

### çŠ¶æ€æ¸…ç†æœºåˆ¶

React DnD åœ¨å¾®å‰ç«¯ç¯å¢ƒä¸­çš„çŠ¶æ€æ¸…ç†ï¼š

```typescript
function unmount() {
  if (root) {
    // æ¸…ç† react-dnd ç›¸å…³çš„å…¨å±€çŠ¶æ€
    try {
      if (window.__REACT_DND_CONTEXT_INSTANCE__) {
        delete window.__REACT_DND_CONTEXT_INSTANCE__;
      }
    } catch (error) {
      console.warn('æ¸…ç†DnDçŠ¶æ€æ—¶å‡ºç°è­¦å‘Š:', error);
    }

    root.unmount();
    root = null;
  }
}
```

---

## ğŸ“ æ€»ç»“

ä½ä»£ç å¯è§†åŒ–ç¼–è¾‘å™¨é‡‡ç”¨ç°ä»£åŒ–çš„å‰ç«¯æŠ€æœ¯æ ˆï¼Œå®ç°äº†å®Œæ•´çš„å¯è§†åŒ–é¡µé¢æ„å»ºåŠŸèƒ½ã€‚é€šè¿‡æ¨¡å—åŒ–çš„æ¶æ„è®¾è®¡ï¼Œç³»ç»Ÿå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚

### æŠ€æœ¯äº®ç‚¹

1. **React DnD æ‹–æ‹½ç³»ç»Ÿ**: å®ç°ç²¾ç¡®çš„ç»„ä»¶æ‹–æ‹½å’Œå®šä½
2. **Zustand çŠ¶æ€ç®¡ç†**: è½»é‡çº§çŠ¶æ€ç®¡ç†ï¼Œç®€åŒ–å¤æ‚çŠ¶æ€æ“ä½œ
3. **ç»„ä»¶åŒ–æ¶æ„**: æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶å’Œç¬¬ä¸‰æ–¹ç»„ä»¶åº“é›†æˆ
4. **å¤šæ ¼å¼ä»£ç å¯¼å‡º**: æ”¯æŒ React JSXã€HTMLã€JSON ä¸‰ç§å¯¼å‡ºæ ¼å¼
5. **å¾®å‰ç«¯é›†æˆ**: åŸºäº qiankun çš„å¾®å‰ç«¯æ¶æ„ï¼Œæ”¯æŒç‹¬ç«‹è¿è¡Œå’Œé›†æˆéƒ¨ç½²

### æ ¸å¿ƒåŠŸèƒ½

- **å¯è§†åŒ–ç¼–è¾‘**: æ‹–æ‹½å¼ç»„ä»¶ç¼–è¾‘ï¼Œå®æ—¶é¢„è§ˆæ•ˆæœ
- **å±æ€§é…ç½®**: åŠ¨æ€ç¼–è¾‘ç»„ä»¶å±æ€§ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹
- **å¸ƒå±€ç³»ç»Ÿ**: åŒå±‚å¸ƒå±€è®¾è®¡ï¼Œæ”¯æŒç»å¯¹å®šä½å’Œæµå¼å¸ƒå±€
- **ä»£ç ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆå¯æ‰§è¡Œçš„å‰ç«¯ä»£ç 
- **æ‰©å±•æœºåˆ¶**: æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶å’Œå±æ€§ç±»å‹æ‰©å±•
